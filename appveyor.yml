version: Build {build} ({branch} branch)

branches:
  only:
    - appveyor

platform: x64

matrix:
  fast_finish: true

configuration:
  - Release
  - Debug

skip_tags: true

image: Visual Studio 2017

shallow_clone: true
clone_depth: 5

environment:
  OSGEO4W_ROOT: C:\Tools\osgeo4w64
  PREFIX_PATH: '%OSGEO4W_ROOT%'
  TARGET_OS: windows


cache:
  - C:\Tools\downloads
  - C:\Tools\osgeo4w64

init:
  - mkdir C:\Tools\downloads
  - curl -s -S -o C:\Tools\downloads\osgeo4w-setup-x86_64.exe http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe
  - echo . | C:\Tools\downloads\osgeo4w-setup-x86_64.exe --autoaccept --no-shortcuts --no-startmenu --no-desktop --quiet-mode --arch x86_64 --download --advanced --site http://download.osgeo.org/osgeo4w --root %OSGEO4W_ROOT% --packages pdal
  - rd /s /q C:\projects\pdal-c

install:
  - set ARCH=%PLATFORM%
  - set BUILD_TYPE=%CONFIGURATION%
  - echo %PREFIX_PATH%
  - call make.bat

build_script:
  - echo "Built %PLATFORM%-%TARGET_OS%-%CONFIGURATION%"

test_script:
  - set GDAL_DATA=%OSGEO4W_ROOT%\share\gdal
  - set PROJ_LIB=%OSGEO4W_ROOT%\share\proj
  - if exist "build\%ARCH%-%TARGET_OS%\test_pdalc.exe" "build\%ARCH%-%TARGET_OS%\test_pdalc.exe"
  - if exist "build\%ARCH%-%TARGET_OS%\test_pdalcd.exe" "build\%ARCH%-%TARGET_OS%\test_pdalcd.exe"

after_test:
  - if exist "build\%ARCH%-%TARGET_OS%\test_pdalc.exe" erase "build\%ARCH%-%TARGET_OS%\test_pdalc.exe"
  - if exist "build\%ARCH%-%TARGET_OS%\test_pdalcd.exe" erase "build\%ARCH%-%TARGET_OS%\test_pdalcd.exe"

